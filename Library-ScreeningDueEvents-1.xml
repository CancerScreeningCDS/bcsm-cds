<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1" localId="0">
   <annotation translatorVersion="3.11.0" translatorOptions="EnableAnnotations,EnableLocators,DisableListDemotion,DisableListPromotion" signatureLevel="Overloads" xsi:type="a:CqlToElmInfo"/>
   <annotation xsi:type="a:Annotation">
      <a:s r="394">
         <a:s>/*  
  Author: CMS Alliance to Modernize Healthcare, operated by THE MITRE Corporation.

  (C) 2024 The MITRE Corporation. All Rights Reserved. 
  Approved for Public Release: 24-2711. 
  Distribution Unlimited.

  Unless otherwise noted, this work is available under an Apache 2.0 license. 
  It was produced by the MITRE Corporation for the Division of Cancer Prevention 
  and Control, Centers for Disease Control and Prevention in accordance with the 
  Statement of Work, contract number 75FCMC18D0047, task order number 75D30123F17931.
*/

library ScreeningDueEvents version '1.0.0'</a:s>
      </a:s>
   </annotation>
   <identifier id="ScreeningDueEvents" system="http://cancerscreeningcds.github.io/bcsm-cds" version="1.0.0"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localId="1" localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="206" locator="16:1-16:26" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="206">
               <a:s>using </a:s>
               <a:s>
                  <a:s>FHIR</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
   </usings>
   <includes>
      <def localId="207" locator="18:1-18:55" localIdentifier="FHIRHelpers" path="http://cancerscreeningcds.github.io/bcsm-cds/FHIRHelpers" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="207">
               <a:s>include </a:s>
               <a:s>
                  <a:s>FHIRHelpers</a:s>
               </a:s>
               <a:s>  version '4.0.1' called FHIRHelpers</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="208" locator="19:1-19:56" localIdentifier="DataElements" path="http://cancerscreeningcds.github.io/bcsm-cds/DataElements" version="1.0.0">
         <annotation xsi:type="a:Annotation">
            <a:s r="208">
               <a:s>include </a:s>
               <a:s>
                  <a:s>DataElements</a:s>
               </a:s>
               <a:s> version '1.0.0' called DataElements</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="209" locator="20:1-20:68" localIdentifier="CSMCommonFunctions" path="http://cancerscreeningcds.github.io/bcsm-cds/CSMCommonFunctions" version="1.0.0">
         <annotation xsi:type="a:Annotation">
            <a:s r="209">
               <a:s>include </a:s>
               <a:s>
                  <a:s>CSMCommonFunctions</a:s>
               </a:s>
               <a:s> version '1.0.0' called CSMCommonFunctions</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="210" locator="21:1-21:61" localIdentifier="BCSMCommon" path="http://cancerscreeningcds.github.io/bcsm-cds/BCSMCommonFunctions" version="1.0.0">
         <annotation xsi:type="a:Annotation">
            <a:s r="210">
               <a:s>include </a:s>
               <a:s>
                  <a:s>BCSMCommonFunctions</a:s>
               </a:s>
               <a:s> version '1.0.0' called BCSMCommon</a:s>
            </a:s>
         </annotation>
      </def>
   </includes>
   <codeSystems>
      <def localId="211" locator="23:1-23:38" name="LOINC" id="http://loinc.org" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="211">
               <a:s>codesystem &quot;LOINC&quot;: 'http://loinc.org'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="212" locator="24:1-24:45" name="SNOMED" id="http://snomed.info/sct" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="212">
               <a:s>codesystem &quot;SNOMED&quot;: 'http://snomed.info/sct'</a:s>
            </a:s>
         </annotation>
      </def>
   </codeSystems>
   <valueSets>
      <def localId="219" locator="31:1-31:101" name="Screening Mammogram" id="http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1032.393" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="219">
               <a:s>valueset &quot;Screening Mammogram&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1032.393'</a:s>
            </a:s>
         </annotation>
      </def>
   </valueSets>
   <codes>
      <def localId="213" locator="27:1-27:91" name="Breast cancer screening" id="268547008" display="Breast cancer screening" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="213">
               <a:s>// Standard codes
code &quot;Breast cancer screening&quot;: '268547008' from </a:s>
               <a:s r="214">
                  <a:s>&quot;SNOMED&quot;</a:s>
               </a:s>
               <a:s> display 'Breast cancer screening'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="214" locator="27:50-27:57" name="SNOMED"/>
      </def>
      <def localId="215" locator="28:1-28:80" name="MG Breast Screening" id="24606-6" display="MG Breast Screening" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="215">
               <a:s>code &quot;MG Breast Screening&quot;: '24606-6' from </a:s>
               <a:s r="216">
                  <a:s>&quot;LOINC&quot;</a:s>
               </a:s>
               <a:s> display 'MG Breast Screening'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="216" locator="28:44-28:50" name="LOINC"/>
      </def>
      <def localId="217" locator="29:1-29:60" name="MR Breast" id="30794-2" display="MR Breast" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="217">
               <a:s>code &quot;MR Breast&quot;: '30794-2' from </a:s>
               <a:s r="218">
                  <a:s>&quot;LOINC&quot;</a:s>
               </a:s>
               <a:s> display 'MR Breast'</a:s>
            </a:s>
         </annotation>
         <codeSystem localId="218" locator="29:34-29:40" name="LOINC"/>
      </def>
   </codes>
   <contexts>
      <def localId="223" locator="33:1-33:15" name="Patient"/>
   </contexts>
   <statements>
      <def localId="221" locator="33:1-33:15" name="Patient" context="Patient">
         <expression localId="222" xsi:type="SingletonFrom">
            <operand localId="220" locator="33:1-33:15" dataType="fhir:Patient" templateId="http://hl7.org/fhir/StructureDefinition/Patient" xsi:type="Retrieve"/>
         </expression>
      </def>
      <def localId="242" locator="132:1-135:69" name="ActiveBreastCancerScreeningCarePlans" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="242">
               <a:s>define ActiveBreastCancerScreeningCarePlans:
  </a:s>
               <a:s r="267">
                  <a:s>
                     <a:s r="243">
                        <a:s r="244">
                           <a:s r="244">
                              <a:s>[CarePlan]</a:s>
                           </a:s>
                        </a:s>
                        <a:s> C</a:s>
                     </a:s>
                  </a:s>
                  <a:s>
    </a:s>
                  <a:s r="245">
                     <a:s>where </a:s>
                     <a:s r="245">
                        <a:s r="250">
                           <a:s r="247">
                              <a:s r="246">
                                 <a:s>C</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="247">
                                 <a:s>status</a:s>
                              </a:s>
                           </a:s>
                           <a:s> in </a:s>
                           <a:s r="248">
                              <a:s>{</a:s>
                              <a:s r="249">
                                 <a:s>'active'</a:s>
                              </a:s>
                              <a:s>}</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
      and </a:s>
                        <a:s r="253">
                           <a:s>exists </a:s>
                           <a:s r="266">
                              <a:s>
                                 <a:s r="254">
                                    <a:s r="256">
                                       <a:s>
                                          <a:s>C.category</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> cat</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> </a:s>
                              <a:s r="257">
                                 <a:s>where </a:s>
                                 <a:s r="257">
                                    <a:s r="258">
                                       <a:s>cat</a:s>
                                    </a:s>
                                    <a:s> ~ </a:s>
                                    <a:s r="259">
                                       <a:s>&quot;Breast cancer screening&quot;</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="267" locator="133:3-135:69" xsi:type="Query">
            <source localId="243" locator="133:3-133:14" alias="C">
               <expression localId="244" locator="133:3-133:12" dataType="fhir:CarePlan" templateId="http://hl7.org/fhir/StructureDefinition/CarePlan" xsi:type="Retrieve"/>
            </source>
            <where localId="245" locator="134:5-135:69" xsi:type="And">
               <operand localId="250" locator="134:11-134:32" xsi:type="In">
                  <operand localId="251" name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <signature localId="252" name="fhir:CarePlanStatus" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="247" locator="134:11-134:18" path="status" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand localId="248" locator="134:23-134:32" xsi:type="List">
                     <element localId="249" locator="134:24-134:31" valueType="t:String" value="active" xsi:type="Literal"/>
                  </operand>
               </operand>
               <operand localId="253" locator="135:11-135:69" xsi:type="Exists">
                  <operand localId="266" locator="135:18-135:69" xsi:type="Query">
                     <source localId="254" locator="135:18-135:31" alias="cat">
                        <expression localId="256" locator="135:18-135:27" path="category" scope="C" xsi:type="Property"/>
                     </source>
                     <where localId="257" locator="135:33-135:69" xsi:type="Equivalent">
                        <signature localId="264" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="265" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="260" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <operand localId="258" locator="135:39-135:41" name="cat" xsi:type="AliasRef"/>
                        </operand>
                        <operand localId="262" xsi:type="ToConcept">
                           <signature localId="263" name="t:Code" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="259" locator="135:45-135:69" name="Breast cancer screening" xsi:type="CodeRef"/>
                        </operand>
                     </where>
                  </operand>
               </operand>
            </where>
         </expression>
      </def>
      <def localId="239" locator="127:1-130:3" name="MostRecentActiveScreeningCarePlan" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="239">
               <a:s>//------------------------------------------------------------------------------
// Care plan
//------------------------------------------------------------------------------

define MostRecentActiveScreeningCarePlan:
  </a:s>
               <a:s r="299">
                  <a:s>Last(</a:s>
                  <a:s r="296">
                     <a:s>
                        <a:s r="240">
                           <a:s r="268">
                              <a:s>
                                 <a:s>ActiveBreastCancerScreeningCarePlans</a:s>
                              </a:s>
                           </a:s>
                           <a:s> C</a:s>
                        </a:s>
                     </a:s>
                     <a:s> 
    </a:s>
                     <a:s r="290">
                        <a:s>sort by </a:s>
                        <a:s r="289">
                           <a:s r="286">
                              <a:s>Coalesce(</a:s>
                              <a:s r="277">
                                 <a:s>start of </a:s>
                                 <a:s r="278">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="281">
                                 <a:s>created</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
                  <a:s>
  )</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="299" locator="128:3-130:3" xsi:type="Last">
            <source localId="296" locator="128:8-129:46" xsi:type="Query">
               <source localId="240" locator="128:8-128:45" alias="C">
                  <expression localId="268" locator="128:8-128:43" name="ActiveBreastCancerScreeningCarePlans" xsi:type="ExpressionRef"/>
               </source>
               <sort localId="290" locator="129:5-129:46">
                  <by localId="289" locator="129:13-129:46" direction="asc" xsi:type="ByExpression">
                     <expression localId="286" locator="129:13-129:46" xsi:type="Coalesce">
                        <operand localId="277" locator="129:22-129:36" xsi:type="Start">
                           <operand localId="279" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                              <signature localId="280" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="278" locator="129:31-129:36" name="period" xsi:type="IdentifierRef"/>
                           </operand>
                        </operand>
                        <operand localId="287" name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <signature localId="288" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="281" locator="129:39-129:45" name="created" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
      </def>
      <def localId="234" locator="150:1-158:11" name="MostRecentActiveScreeningCarePlanRequestGroup" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="234">
               <a:s>define MostRecentActiveScreeningCarePlanRequestGroup:
  </a:s>
               <a:s r="235">
                  <a:s>if </a:s>
                  <a:s r="236">
                     <a:s r="309">
                        <a:s r="307">
                           <a:s r="306">
                              <a:s r="237">
                                 <a:s r="301">
                                    <a:s r="300">
                                       <a:s>MostRecentActiveScreeningCarePlan</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="301">
                                       <a:s>activity</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="302">[0]</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="306">
                                 <a:s>reference</a:s>
                              </a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="307">
                              <a:s>reference</a:s>
                           </a:s>
                        </a:s>
                        <a:s> is not null</a:s>
                     </a:s>
                     <a:s>
    and </a:s>
                     <a:s r="324">
                        <a:s>StartsWith(</a:s>
                        <a:s r="318">
                           <a:s r="317">
                              <a:s r="310">
                                 <a:s r="312">
                                    <a:s r="311">
                                       <a:s>MostRecentActiveScreeningCarePlan</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="312">
                                       <a:s>activity</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="313">[0]</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="317">
                                 <a:s>reference</a:s>
                              </a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="318">
                              <a:s>reference</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,</a:s>
                        <a:s r="319">
                           <a:s>'RequestGroup/'</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                  </a:s>
                  <a:s>
  then
    </a:s>
                  <a:s r="363">
                     <a:s>First(
      </a:s>
                     <a:s r="360">
                        <a:s>
                           <a:s r="327">
                              <a:s r="328">
                                 <a:s r="328">
                                    <a:s>[RequestGroup]</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> R</a:s>
                           </a:s>
                        </a:s>
                        <a:s> </a:s>
                        <a:s r="329">
                           <a:s>where 
        </a:s>
                           <a:s r="329">
                              <a:s r="331">
                                 <a:s r="330">
                                    <a:s>R</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="331">
                                    <a:s>id</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> = </a:s>
                              <a:s r="353">
                                 <a:s>Last(</a:s>
                                 <a:s r="346">
                                    <a:s>Split(</a:s>
                                    <a:s r="340">
                                       <a:s r="339">
                                          <a:s r="332">
                                             <a:s r="334">
                                                <a:s r="333">
                                                   <a:s>MostRecentActiveScreeningCarePlan</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="334">
                                                   <a:s>activity</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s r="335">[0]</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="339">
                                             <a:s>reference</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="340">
                                          <a:s>reference</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,</a:s>
                                    <a:s r="341">
                                       <a:s>'/'</a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    )</a:s>
                  </a:s>
                  <a:s r="364">
  else null</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="235" locator="151:3-158:11" xsi:type="If">
            <condition localId="236" locator="151:6-152:101" xsi:type="And">
               <operand localId="309" locator="151:6-151:82" xsi:type="Not">
                  <operand localId="308" locator="151:6-151:82" xsi:type="IsNull">
                     <operand localId="307" locator="151:6-151:70" path="reference" xsi:type="Property">
                        <source localId="306" locator="151:6-151:60" path="reference" xsi:type="Property">
                           <source localId="237" locator="151:6-151:50" xsi:type="Indexer">
                              <signature localId="303" xsi:type="ListTypeSpecifier">
                                 <elementType localId="304" name="fhir:CarePlan.Activity" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <signature localId="305" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="301" locator="151:6-151:47" path="activity" xsi:type="Property">
                                 <source localId="300" locator="151:6-151:38" name="MostRecentActiveScreeningCarePlan" xsi:type="ExpressionRef"/>
                              </operand>
                              <operand localId="302" locator="151:49" valueType="t:Integer" value="0" xsi:type="Literal"/>
                           </source>
                        </source>
                     </operand>
                  </operand>
               </operand>
               <operand localId="324" locator="152:9-152:101" xsi:type="StartsWith">
                  <operand localId="325" name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <signature localId="326" name="fhir:string" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="318" locator="152:20-152:84" path="reference" xsi:type="Property">
                        <source localId="317" locator="152:20-152:74" path="reference" xsi:type="Property">
                           <source localId="310" locator="152:20-152:64" xsi:type="Indexer">
                              <signature localId="314" xsi:type="ListTypeSpecifier">
                                 <elementType localId="315" name="fhir:CarePlan.Activity" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <signature localId="316" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="312" locator="152:20-152:61" path="activity" xsi:type="Property">
                                 <source localId="311" locator="152:20-152:52" name="MostRecentActiveScreeningCarePlan" xsi:type="ExpressionRef"/>
                              </operand>
                              <operand localId="313" locator="152:63" valueType="t:Integer" value="0" xsi:type="Literal"/>
                           </source>
                        </source>
                     </operand>
                  </operand>
                  <operand localId="319" locator="152:86-152:100" valueType="t:String" value="RequestGroup/" xsi:type="Literal"/>
               </operand>
            </condition>
            <then localId="363" locator="154:5-157:5" xsi:type="First">
               <source localId="360" locator="155:7-156:97" xsi:type="Query">
                  <source localId="327" locator="155:7-155:22" alias="R">
                     <expression localId="328" locator="155:7-155:20" dataType="fhir:RequestGroup" templateId="http://hl7.org/fhir/StructureDefinition/RequestGroup" xsi:type="Retrieve"/>
                  </source>
                  <where localId="329" locator="155:24-156:97" xsi:type="Equal">
                     <signature localId="358" name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <signature localId="359" name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="356" name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <signature localId="357" name="fhir:string" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="331" locator="156:9-156:12" path="id" scope="R" xsi:type="Property"/>
                     </operand>
                     <operand localId="353" locator="156:16-156:97" xsi:type="Last">
                        <signature localId="354" xsi:type="ListTypeSpecifier">
                           <elementType localId="355" name="t:String" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <source localId="346" locator="156:21-156:96" xsi:type="Split">
                           <stringToSplit localId="347" name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                              <signature localId="348" name="fhir:string" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="340" locator="156:27-156:91" path="reference" xsi:type="Property">
                                 <source localId="339" locator="156:27-156:81" path="reference" xsi:type="Property">
                                    <source localId="332" locator="156:27-156:71" xsi:type="Indexer">
                                       <signature localId="336" xsi:type="ListTypeSpecifier">
                                          <elementType localId="337" name="fhir:CarePlan.Activity" xsi:type="NamedTypeSpecifier"/>
                                       </signature>
                                       <signature localId="338" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                                       <operand localId="334" locator="156:27-156:68" path="activity" xsi:type="Property">
                                          <source localId="333" locator="156:27-156:59" name="MostRecentActiveScreeningCarePlan" xsi:type="ExpressionRef"/>
                                       </operand>
                                       <operand localId="335" locator="156:70" valueType="t:Integer" value="0" xsi:type="Literal"/>
                                    </source>
                                 </source>
                              </operand>
                           </stringToSplit>
                           <separator localId="341" locator="156:93-156:95" valueType="t:String" value="/" xsi:type="Literal"/>
                        </source>
                     </operand>
                  </where>
               </source>
            </then>
            <else localId="365" asType="fhir:RequestGroup" xsi:type="As">
               <operand localId="364" locator="158:8-158:11" xsi:type="Null"/>
            </else>
         </expression>
      </def>
      <def localId="381" locator="210:1-215:3" name="ActivityPlannedDate" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="381">
               <a:s>//------------------------------------------------------------------------------
// planned due date
//------------------------------------------------------------------------------

define function ActivityPlannedDate(timing Choice&lt;FHIR.Timing,FHIR.Period>):
  </a:s>
               <a:s r="1168">
                  <a:s r="1168">
                     <a:s>Coalesce(
    </a:s>
                     <a:s r="1155">
                        <a:s>MostRecentTimingEvent(</a:s>
                        <a:s r="1152">
                           <a:s r="1153">
                              <a:s>timing</a:s>
                           </a:s>
                           <a:s> as </a:s>
                           <a:s r="1154">
                              <a:s>FHIR.Timing</a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>,
    </a:s>
                     <a:s r="1160">
                        <a:s r="1159">
                           <a:s r="1156">
                              <a:s>(</a:s>
                              <a:s r="1156">
                                 <a:s r="1157">
                                    <a:s>timing</a:s>
                                 </a:s>
                                 <a:s> as </a:s>
                                 <a:s r="1158">
                                    <a:s>FHIR.Period</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="1159">
                              <a:s>&quot;start&quot;</a:s>
                           </a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="1160">
                           <a:s>value</a:s>
                        </a:s>
                     </a:s>
                     <a:s>,
    </a:s>
                     <a:s r="1165">
                        <a:s r="1164">
                           <a:s r="1161">
                              <a:s>(</a:s>
                              <a:s r="1161">
                                 <a:s r="1162">
                                    <a:s>timing</a:s>
                                 </a:s>
                                 <a:s> as </a:s>
                                 <a:s r="1163">
                                    <a:s>FHIR.Period</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="1164">
                              <a:s>&quot;end&quot;</a:s>
                           </a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="1165">
                           <a:s>value</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  )</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="1168" locator="211:3-215:3" xsi:type="Coalesce">
            <operand localId="1155" locator="212:5-212:48" name="MostRecentTimingEvent" xsi:type="FunctionRef">
               <operand localId="1152" locator="212:27-212:47" strict="false" xsi:type="As">
                  <operand localId="1153" locator="212:27-212:32" name="timing" xsi:type="OperandRef"/>
                  <asTypeSpecifier localId="1154" locator="212:37-212:47" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
               </operand>
            </operand>
            <operand localId="1160" locator="213:5-213:41" path="value" xsi:type="Property">
               <source localId="1159" locator="213:5-213:35" path="start" xsi:type="Property">
                  <source localId="1156" locator="213:5-213:27" strict="false" xsi:type="As">
                     <operand localId="1157" locator="213:6-213:11" name="timing" xsi:type="OperandRef"/>
                     <asTypeSpecifier localId="1158" locator="213:16-213:26" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                  </source>
               </source>
            </operand>
            <operand localId="1165" locator="214:5-214:39" path="value" xsi:type="Property">
               <source localId="1164" locator="214:5-214:33" path="end" xsi:type="Property">
                  <source localId="1161" locator="214:5-214:27" strict="false" xsi:type="As">
                     <operand localId="1162" locator="214:6-214:11" name="timing" xsi:type="OperandRef"/>
                     <asTypeSpecifier localId="1163" locator="214:16-214:26" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                  </source>
               </source>
            </operand>
         </expression>
         <operand localId="385" name="timing">
            <operandTypeSpecifier localId="384" locator="210:44-210:74" xsi:type="ChoiceTypeSpecifier">
               <choice localId="382" locator="210:51-210:61" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
               <choice localId="383" locator="210:63-210:73" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="394" locator="217:1-218:37" name="MostRecentTimingEvent" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="394">
               <a:s>define function MostRecentTimingEvent(timing FHIR.Timing):
  </a:s>
               <a:s r="1191">
                  <a:s r="1191">
                     <a:s r="1188">
                        <a:s>Last(</a:s>
                        <a:s r="1183">
                           <a:s>
                              <a:s r="1169">
                                 <a:s r="1171">
                                    <a:s>
                                       <a:s>timing.event</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> E</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="1172"> sort asc</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>.</a:s>
                     <a:s r="1191">
                        <a:s>value</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="1191" locator="218:3-218:37" path="value" xsi:type="Property">
            <source localId="1188" locator="218:3-218:31" xsi:type="Last">
               <signature localId="1189" xsi:type="ListTypeSpecifier">
                  <elementType localId="1190" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
               </signature>
               <source localId="1183" locator="218:8-218:30" xsi:type="Query">
                  <source localId="1169" locator="218:8-218:21" alias="E">
                     <expression localId="1171" locator="218:8-218:19" path="event" xsi:type="Property">
                        <source localId="1170" name="timing" xsi:type="OperandRef"/>
                     </expression>
                  </source>
                  <sort localId="1172" locator="218:23-218:30">
                     <by localId="1173" direction="asc" xsi:type="ByDirection"/>
                  </sort>
               </source>
            </source>
         </expression>
         <operand localId="396" name="timing">
            <operandTypeSpecifier localId="395" locator="217:46-217:56" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="231" locator="141:1-148:3" name="ScreeningRequestGroupActions" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="231">
               <a:s>//------------------------------------------------------------------------------
// Care plan/Request group
//------------------------------------------------------------------------------

define ScreeningRequestGroupActions:
  </a:s>
               <a:s r="450">
                  <a:s>
                     <a:s r="232">
                        <a:s r="367">
                           <a:s>
                              <a:s>MostRecentActiveScreeningCarePlanRequestGroup.action</a:s>
                           </a:s>
                        </a:s>
                        <a:s> A</a:s>
                     </a:s>
                  </a:s>
                  <a:s>
  </a:s>
                  <a:s r="368">
                     <a:s>return </a:s>
                     <a:s r="369">
                        <a:s>{
    </a:s>
                        <a:s>
                           <a:s>code: </a:s>
                           <a:s r="376">
                              <a:s>First(</a:s>
                              <a:s r="371">
                                 <a:s r="370">
                                    <a:s>A</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="371">
                                    <a:s>code</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    </a:s>
                        <a:s>
                           <a:s>plannedDue: </a:s>
                           <a:s r="386">
                              <a:s>ActivityPlannedDate(</a:s>
                              <a:s r="380">
                                 <a:s r="379">
                                    <a:s>A</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="380">
                                    <a:s>timing</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    </a:s>
                        <a:s>
                           <a:s>plannedStart: </a:s>
                           <a:s r="444">
                              <a:s r="434">
                                 <a:s>FHIRHelpers</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="444">
                                 <a:s>ToDateTime(</a:s>
                                 <a:s r="443">
                                    <a:s r="435">
                                       <a:s>(</a:s>
                                       <a:s r="435">
                                          <a:s r="441">
                                             <a:s r="440">
                                                <a:s r="436">
                                                   <a:s>(</a:s>
                                                   <a:s r="436">
                                                      <a:s r="438">
                                                         <a:s r="437">
                                                            <a:s>A</a:s>
                                                         </a:s>
                                                         <a:s>.</a:s>
                                                         <a:s r="438">
                                                            <a:s>timing</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s> as </a:s>
                                                      <a:s r="439">
                                                         <a:s>Timing</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s>)</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="440">
                                                   <a:s>repeat</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="441">
                                                <a:s>bounds</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> as </a:s>
                                          <a:s r="442">
                                             <a:s>Period</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="443">
                                       <a:s>start</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    </a:s>
                        <a:s>
                           <a:s>timing: </a:s>
                           <a:s r="446">
                              <a:s r="448">
                                 <a:s r="447">
                                    <a:s>A</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="448">
                                    <a:s>timing</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> as </a:s>
                              <a:s r="449">
                                 <a:s>FHIR.Timing</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
  }</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="450" locator="142:3-148:3" xsi:type="Query">
            <source localId="232" locator="142:3-142:56" alias="A">
               <expression localId="367" locator="142:3-142:54" path="action" xsi:type="Property">
                  <source localId="366" name="MostRecentActiveScreeningCarePlanRequestGroup" xsi:type="ExpressionRef"/>
               </expression>
            </source>
            <return localId="368" locator="143:3-148:3">
               <expression localId="369" locator="143:10-148:3" xsi:type="Tuple">
                  <element name="code">
                     <value localId="376" locator="144:11-144:23" xsi:type="First">
                        <signature localId="377" xsi:type="ListTypeSpecifier">
                           <elementType localId="378" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <source localId="371" locator="144:17-144:22" path="code" scope="A" xsi:type="Property"/>
                     </value>
                  </element>
                  <element name="plannedDue">
                     <value localId="386" locator="145:17-145:45" name="ActivityPlannedDate" xsi:type="FunctionRef">
                        <operand localId="387" xsi:type="As">
                           <operand localId="380" locator="145:37-145:44" path="timing" scope="A" xsi:type="Property"/>
                           <asTypeSpecifier localId="388" xsi:type="ChoiceTypeSpecifier">
                              <choice localId="389" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                              <choice localId="390" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                           </asTypeSpecifier>
                        </operand>
                     </value>
                  </element>
                  <element name="plannedStart">
                     <value localId="444" locator="146:19-146:94" name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <signature localId="445" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="443" locator="146:42-146:93" path="start" xsi:type="Property">
                           <source localId="435" locator="146:42-146:87" strict="false" xsi:type="As">
                              <operand localId="441" locator="146:43-146:76" path="bounds" xsi:type="Property">
                                 <source localId="440" locator="146:43-146:69" path="repeat" xsi:type="Property">
                                    <source localId="436" locator="146:43-146:62" strict="false" xsi:type="As">
                                       <operand localId="438" locator="146:44-146:51" path="timing" scope="A" xsi:type="Property"/>
                                       <asTypeSpecifier localId="439" locator="146:56-146:61" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                                    </source>
                                 </source>
                              </operand>
                              <asTypeSpecifier localId="442" locator="146:81-146:86" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                     </value>
                  </element>
                  <element name="timing">
                     <value localId="446" locator="147:13-147:35" strict="false" xsi:type="As">
                        <operand localId="448" locator="147:13-147:20" path="timing" scope="A" xsi:type="Property"/>
                        <asTypeSpecifier localId="449" locator="147:25-147:35" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                     </value>
                  </element>
               </expression>
            </return>
         </expression>
      </def>
      <def localId="456" locator="178:1-186:3" name="MostRecentActiveScreeningCarePlanServiceRequests" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="456">
               <a:s>define MostRecentActiveScreeningCarePlanServiceRequests:
  </a:s>
               <a:s r="516">
                  <a:s>
                     <a:s r="457">
                        <a:s r="459">
                           <a:s>
                              <a:s>MostRecentActiveScreeningCarePlan.activity</a:s>
                           </a:s>
                        </a:s>
                        <a:s> A</a:s>
                     </a:s>
                  </a:s>
                  <a:s>
  </a:s>
                  <a:s r="460">
                     <a:s>where
    </a:s>
                     <a:s r="460">
                        <a:s r="465">
                           <a:s r="463">
                              <a:s r="462">
                                 <a:s r="461">
                                    <a:s>A</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="462">
                                    <a:s>reference</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="463">
                                 <a:s>reference</a:s>
                              </a:s>
                           </a:s>
                           <a:s> is not null</a:s>
                        </a:s>
                        <a:s> and </a:s>
                        <a:s r="474">
                           <a:s>StartsWith(</a:s>
                           <a:s r="468">
                              <a:s r="467">
                                 <a:s r="466">
                                    <a:s>A</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="467">
                                    <a:s>reference</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="468">
                                 <a:s>reference</a:s>
                              </a:s>
                           </a:s>
                           <a:s>,</a:s>
                           <a:s r="469">
                              <a:s>'ServiceRequest/'</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
                  <a:s>
  </a:s>
                  <a:s r="477">
                     <a:s>return </a:s>
                     <a:s r="478">
                        <a:s>singleton from </a:s>
                        <a:s r="515">
                           <a:s>(
    </a:s>
                           <a:s r="515">
                              <a:s>
                                 <a:s r="479">
                                    <a:s r="480">
                                       <a:s r="480">
                                          <a:s>[ServiceRequest]</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> R</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> 
    </a:s>
                              <a:s r="481">
                                 <a:s>where </a:s>
                                 <a:s r="481">
                                    <a:s r="482">
                                       <a:s r="484">
                                          <a:s r="483">
                                             <a:s>R</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="484">
                                             <a:s>id</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> = </a:s>
                                       <a:s r="500">
                                          <a:s>Last(</a:s>
                                          <a:s r="493">
                                             <a:s>Split(</a:s>
                                             <a:s r="487">
                                                <a:s r="486">
                                                   <a:s r="485">
                                                      <a:s>A</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="486">
                                                      <a:s>reference</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="487">
                                                   <a:s>reference</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>,</a:s>
                                             <a:s r="488">
                                                <a:s>'/'</a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>
      and </a:s>
                                    <a:s r="507">
                                       <a:s r="509">
                                          <a:s r="508">
                                             <a:s>R</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="509">
                                             <a:s>intent</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> = </a:s>
                                       <a:s r="510">
                                          <a:s>'plan'</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s> //from CPG workflow        
  )</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="516" locator="179:3-186:3" xsi:type="Query">
            <source localId="457" locator="179:3-179:46" alias="A">
               <expression localId="459" locator="179:3-179:44" path="activity" xsi:type="Property">
                  <source localId="458" name="MostRecentActiveScreeningCarePlan" xsi:type="ExpressionRef"/>
               </expression>
            </source>
            <where localId="460" locator="180:3-181:93" xsi:type="And">
               <operand localId="465" locator="181:5-181:37" xsi:type="Not">
                  <operand localId="464" locator="181:5-181:37" xsi:type="IsNull">
                     <operand localId="463" locator="181:5-181:25" path="reference" xsi:type="Property">
                        <source localId="462" locator="181:5-181:15" path="reference" scope="A" xsi:type="Property"/>
                     </operand>
                  </operand>
               </operand>
               <operand localId="474" locator="181:43-181:93" xsi:type="StartsWith">
                  <operand localId="475" name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <signature localId="476" name="fhir:string" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="468" locator="181:54-181:74" path="reference" xsi:type="Property">
                        <source localId="467" locator="181:54-181:64" path="reference" scope="A" xsi:type="Property"/>
                     </operand>
                  </operand>
                  <operand localId="469" locator="181:76-181:92" valueType="t:String" value="ServiceRequest/" xsi:type="Literal"/>
               </operand>
            </where>
            <return localId="477" locator="182:3-186:3">
               <expression localId="478" locator="182:10-186:3" xsi:type="SingletonFrom">
                  <operand localId="515" locator="182:25-186:3" xsi:type="Query">
                     <source localId="479" locator="183:5-183:22" alias="R">
                        <expression localId="480" locator="183:5-183:20" dataType="fhir:ServiceRequest" templateId="http://hl7.org/fhir/StructureDefinition/ServiceRequest" xsi:type="Retrieve"/>
                     </source>
                     <where localId="481" locator="184:5-185:27" xsi:type="And">
                        <operand localId="482" locator="184:11-184:55" xsi:type="Equal">
                           <signature localId="505" name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <signature localId="506" name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="503" name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                              <signature localId="504" name="fhir:string" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="484" locator="184:11-184:14" path="id" scope="R" xsi:type="Property"/>
                           </operand>
                           <operand localId="500" locator="184:18-184:55" xsi:type="Last">
                              <signature localId="501" xsi:type="ListTypeSpecifier">
                                 <elementType localId="502" name="t:String" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <source localId="493" locator="184:23-184:54" xsi:type="Split">
                                 <stringToSplit localId="494" name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <signature localId="495" name="fhir:string" xsi:type="NamedTypeSpecifier"/>
                                    <operand localId="487" locator="184:29-184:49" path="reference" xsi:type="Property">
                                       <source localId="486" locator="184:29-184:39" path="reference" scope="A" xsi:type="Property"/>
                                    </operand>
                                 </stringToSplit>
                                 <separator localId="488" locator="184:51-184:53" valueType="t:String" value="/" xsi:type="Literal"/>
                              </source>
                           </operand>
                        </operand>
                        <operand localId="507" locator="185:11-185:27" xsi:type="Equal">
                           <signature localId="513" name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <signature localId="514" name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="511" name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                              <signature localId="512" name="fhir:ServiceRequestIntent" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="509" locator="185:11-185:18" path="intent" scope="R" xsi:type="Property"/>
                           </operand>
                           <operand localId="510" locator="185:22-185:27" valueType="t:String" value="plan" xsi:type="Literal"/>
                        </operand>
                     </where>
                  </operand>
               </expression>
            </return>
         </expression>
      </def>
      <def localId="453" locator="164:1-176:3" name="ScreeningServiceRequests" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="453">
               <a:s>//------------------------------------------------------------------------------
// Care plan/Service requests
//------------------------------------------------------------------------------

define ScreeningServiceRequests:
  </a:s>
               <a:s r="567">
                  <a:s>
                     <a:s r="454">
                        <a:s r="517">
                           <a:s>
                              <a:s>MostRecentActiveScreeningCarePlanServiceRequests</a:s>
                           </a:s>
                        </a:s>
                        <a:s> R</a:s>
                     </a:s>
                  </a:s>
                  <a:s>
  </a:s>
                  <a:s r="518">
                     <a:s>return </a:s>
                     <a:s r="519">
                        <a:s>{
    </a:s>
                        <a:s>
                           <a:s>code: </a:s>
                           <a:s r="521">
                              <a:s r="520">
                                 <a:s>R</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="521">
                                 <a:s>code</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    </a:s>
                        <a:s>
                           <a:s>plannedDue: </a:s>
                           <a:s r="550">
                              <a:s>Coalesce(
      </a:s>
                              <a:s r="526">
                                 <a:s>ActivityPlannedDate(</a:s>
                                 <a:s r="522">
                                    <a:s r="524">
                                       <a:s r="523">
                                          <a:s>R</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="524">
                                          <a:s>occurrence</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> as </a:s>
                                    <a:s r="525">
                                       <a:s>Timing</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>,
      </a:s>
                              <a:s r="535">
                                 <a:s r="531">
                                    <a:s>(</a:s>
                                    <a:s r="531">
                                       <a:s r="533">
                                          <a:s r="532">
                                             <a:s>R</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="533">
                                             <a:s>occurrence</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> as </a:s>
                                       <a:s r="534">
                                          <a:s>FHIR.dateTime</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="535">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>,
      </a:s>
                              <a:s r="541">
                                 <a:s r="540">
                                    <a:s r="536">
                                       <a:s>(</a:s>
                                       <a:s r="536">
                                          <a:s r="538">
                                             <a:s r="537">
                                                <a:s>R</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="538">
                                                <a:s>occurrence</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> as </a:s>
                                          <a:s r="539">
                                             <a:s>FHIR.Period</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="540">
                                       <a:s>&quot;end&quot;</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="541">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>,
      </a:s>
                              <a:s r="547">
                                 <a:s r="546">
                                    <a:s r="542">
                                       <a:s>(</a:s>
                                       <a:s r="542">
                                          <a:s r="544">
                                             <a:s r="543">
                                                <a:s>R</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="544">
                                                <a:s>occurrence</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> as </a:s>
                                          <a:s r="545">
                                             <a:s>FHIR.Period</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="546">
                                       <a:s>&quot;start&quot;</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="547">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
    )</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    </a:s>
                        <a:s>
                           <a:s>plannedStart: </a:s>
                           <a:s r="561">
                              <a:s r="551">
                                 <a:s>FHIRHelpers</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="561">
                                 <a:s>ToDateTime(</a:s>
                                 <a:s r="560">
                                    <a:s r="552">
                                       <a:s>(</a:s>
                                       <a:s r="552">
                                          <a:s r="558">
                                             <a:s r="557">
                                                <a:s r="553">
                                                   <a:s>(</a:s>
                                                   <a:s r="553">
                                                      <a:s r="555">
                                                         <a:s r="554">
                                                            <a:s>R</a:s>
                                                         </a:s>
                                                         <a:s>.</a:s>
                                                         <a:s r="555">
                                                            <a:s>occurrence</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s> as </a:s>
                                                      <a:s r="556">
                                                         <a:s>FHIR.Timing</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s>)</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="557">
                                                   <a:s>repeat</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="558">
                                                <a:s>bounds</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> as </a:s>
                                          <a:s r="559">
                                             <a:s>Period</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="560">
                                       <a:s>start</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    </a:s>
                        <a:s>
                           <a:s>timing: </a:s>
                           <a:s r="563">
                              <a:s r="565">
                                 <a:s r="564">
                                    <a:s>R</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="565">
                                    <a:s>occurrence</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> as </a:s>
                              <a:s r="566">
                                 <a:s>FHIR.Timing</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
  }</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="567" locator="165:3-176:3" xsi:type="Query">
            <source localId="454" locator="165:3-165:52" alias="R">
               <expression localId="517" locator="165:3-165:50" name="MostRecentActiveScreeningCarePlanServiceRequests" xsi:type="ExpressionRef"/>
            </source>
            <return localId="518" locator="166:3-176:3">
               <expression localId="519" locator="166:10-176:3" xsi:type="Tuple">
                  <element name="code">
                     <value localId="521" locator="167:11-167:16" path="code" scope="R" xsi:type="Property"/>
                  </element>
                  <element name="plannedDue">
                     <value localId="550" locator="168:17-173:5" xsi:type="Coalesce">
                        <operand localId="526" locator="169:7-169:49" name="ActivityPlannedDate" xsi:type="FunctionRef">
                           <operand localId="527" xsi:type="As">
                              <operand localId="522" locator="169:27-169:48" strict="false" xsi:type="As">
                                 <operand localId="524" locator="169:27-169:38" path="occurrence" scope="R" xsi:type="Property"/>
                                 <asTypeSpecifier localId="525" locator="169:43-169:48" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                              </operand>
                              <asTypeSpecifier localId="528" xsi:type="ChoiceTypeSpecifier">
                                 <choice localId="529" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                                 <choice localId="530" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </asTypeSpecifier>
                           </operand>
                        </operand>
                        <operand localId="535" locator="170:7-170:43" path="value" xsi:type="Property">
                           <source localId="531" locator="170:7-170:37" strict="false" xsi:type="As">
                              <operand localId="533" locator="170:8-170:19" path="occurrence" scope="R" xsi:type="Property"/>
                              <asTypeSpecifier localId="534" locator="170:24-170:36" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand localId="541" locator="171:7-171:47" path="value" xsi:type="Property">
                           <source localId="540" locator="171:7-171:41" path="end" xsi:type="Property">
                              <source localId="536" locator="171:7-171:35" strict="false" xsi:type="As">
                                 <operand localId="538" locator="171:8-171:19" path="occurrence" scope="R" xsi:type="Property"/>
                                 <asTypeSpecifier localId="539" locator="171:24-171:34" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand localId="547" locator="172:7-172:49" path="value" xsi:type="Property">
                           <source localId="546" locator="172:7-172:43" path="start" xsi:type="Property">
                              <source localId="542" locator="172:7-172:35" strict="false" xsi:type="As">
                                 <operand localId="544" locator="172:8-172:19" path="occurrence" scope="R" xsi:type="Property"/>
                                 <asTypeSpecifier localId="545" locator="172:24-172:34" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                     </value>
                  </element>
                  <element name="plannedStart">
                     <value localId="561" locator="174:19-174:103" name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <signature localId="562" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="560" locator="174:42-174:102" path="start" xsi:type="Property">
                           <source localId="552" locator="174:42-174:96" strict="false" xsi:type="As">
                              <operand localId="558" locator="174:43-174:85" path="bounds" xsi:type="Property">
                                 <source localId="557" locator="174:43-174:78" path="repeat" xsi:type="Property">
                                    <source localId="553" locator="174:43-174:71" strict="false" xsi:type="As">
                                       <operand localId="555" locator="174:44-174:55" path="occurrence" scope="R" xsi:type="Property"/>
                                       <asTypeSpecifier localId="556" locator="174:60-174:70" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                                    </source>
                                 </source>
                              </operand>
                              <asTypeSpecifier localId="559" locator="174:90-174:95" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                     </value>
                  </element>
                  <element name="timing">
                     <value localId="563" locator="175:13-175:39" strict="false" xsi:type="As">
                        <operand localId="565" locator="175:13-175:24" path="occurrence" scope="R" xsi:type="Property"/>
                        <asTypeSpecifier localId="566" locator="175:29-175:39" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                     </value>
                  </element>
               </expression>
            </return>
         </expression>
      </def>
      <def localId="229" locator="81:1-82:61" name="ScreeningActivities" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="229">
               <a:s>define ScreeningActivities:
  </a:s>
               <a:s r="569">
                  <a:s r="451">
                     <a:s>ScreeningRequestGroupActions</a:s>
                  </a:s>
                  <a:s> union </a:s>
                  <a:s r="568">
                     <a:s>ScreeningServiceRequests</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="569" locator="82:3-82:61" xsi:type="Union">
            <operand localId="451" locator="82:3-82:30" name="ScreeningRequestGroupActions" xsi:type="ExpressionRef"/>
            <operand localId="568" locator="82:38-82:61" name="ScreeningServiceRequests" xsi:type="ExpressionRef"/>
         </expression>
      </def>
      <def localId="572" locator="195:1-199:66" name="NextPlannedActivityByCode" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="572">
               <a:s>define function NextPlannedActivityByCode(
  activities List&lt;Tuple{code FHIR.CodeableConcept,plannedDue System.DateTime,plannedStart System.DateTime,timing FHIR.Timing}>,
  code Code
):
  </a:s>
               <a:s r="1108">
                  <a:s r="1108">
                     <a:s>NextPlannedActivity(</a:s>
                     <a:s r="1107">
                        <a:s>
                           <a:s r="1093">
                              <a:s r="1094">
                                 <a:s>
                                    <a:s>activities</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> A</a:s>
                           </a:s>
                        </a:s>
                        <a:s> </a:s>
                        <a:s r="1095">
                           <a:s>where </a:s>
                           <a:s r="1095">
                              <a:s r="1097">
                                 <a:s r="1096">
                                    <a:s>A</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="1097">
                                    <a:s>code</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> ~ </a:s>
                              <a:s r="1102">
                                 <a:s>ToConcept(</a:s>
                                 <a:s r="1098">
                                    <a:s>code</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="1108" locator="199:3-199:66" name="NextPlannedActivity" xsi:type="FunctionRef">
            <operand localId="1107" locator="199:23-199:65" xsi:type="Query">
               <source localId="1093" locator="199:23-199:34" alias="A">
                  <expression localId="1094" locator="199:23-199:32" name="activities" xsi:type="OperandRef"/>
               </source>
               <where localId="1095" locator="199:36-199:65" xsi:type="Equivalent">
                  <signature localId="1105" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="1106" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="1104" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand localId="1097" locator="199:42-199:47" path="code" scope="A" xsi:type="Property"/>
                  </operand>
                  <operand localId="1102" locator="199:51-199:65" xsi:type="ToConcept">
                     <signature localId="1103" name="t:Code" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="1098" locator="199:61-199:64" name="code" xsi:type="OperandRef"/>
                  </operand>
               </where>
            </operand>
         </expression>
         <operand localId="583" name="activities">
            <operandTypeSpecifier localId="573" locator="196:14-196:126" xsi:type="ListTypeSpecifier">
               <elementType localId="574" locator="196:19-196:125" xsi:type="TupleTypeSpecifier">
                  <element localId="575" locator="196:25-196:49" name="code">
                     <elementType localId="576" locator="196:30-196:49" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="577" locator="196:51-196:76" name="plannedDue">
                     <elementType localId="578" locator="196:62-196:76" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="579" locator="196:78-196:105" name="plannedStart">
                     <elementType localId="580" locator="196:91-196:105" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="581" locator="196:107-196:124" name="timing">
                     <elementType localId="582" locator="196:114-196:124" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                  </element>
               </elementType>
            </operandTypeSpecifier>
         </operand>
         <operand localId="585" name="code">
            <operandTypeSpecifier localId="584" locator="197:8-197:11" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="602" locator="201:1-204:56" name="NextPlannedActivity" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="602">
               <a:s>define function NextPlannedActivity(
  activities List&lt;Tuple{code FHIR.CodeableConcept,plannedDue System.DateTime,plannedStart System.DateTime,timing FHIR.Timing}>
):
  </a:s>
               <a:s r="1141">
                  <a:s r="1141">
                     <a:s>Last(</a:s>
                     <a:s r="1128">
                        <a:s>
                           <a:s r="1109">
                              <a:s r="1110">
                                 <a:s>
                                    <a:s>activities</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> A</a:s>
                           </a:s>
                        </a:s>
                        <a:s> </a:s>
                        <a:s r="1122">
                           <a:s>sort by </a:s>
                           <a:s r="1121">
                              <a:s r="1116">
                                 <a:s>ActivityPlannedDate(</a:s>
                                 <a:s r="1115">
                                    <a:s>timing</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="1141" locator="204:3-204:56" xsi:type="Last">
            <signature localId="1142" xsi:type="ListTypeSpecifier">
               <elementType localId="1143" xsi:type="TupleTypeSpecifier">
                  <element localId="1144" name="code">
                     <elementType localId="1145" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="1146" name="plannedDue">
                     <elementType localId="1147" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="1148" name="plannedStart">
                     <elementType localId="1149" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="1150" name="timing">
                     <elementType localId="1151" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                  </element>
               </elementType>
            </signature>
            <source localId="1128" locator="204:8-204:55" xsi:type="Query">
               <source localId="1109" locator="204:8-204:19" alias="A">
                  <expression localId="1110" locator="204:8-204:17" name="activities" xsi:type="OperandRef"/>
               </source>
               <sort localId="1122" locator="204:21-204:55">
                  <by localId="1121" locator="204:29-204:55" direction="asc" xsi:type="ByExpression">
                     <expression localId="1116" locator="204:29-204:55" name="ActivityPlannedDate" xsi:type="FunctionRef">
                        <operand localId="1117" xsi:type="As">
                           <operand localId="1115" locator="204:49-204:54" name="timing" xsi:type="IdentifierRef"/>
                           <asTypeSpecifier localId="1118" xsi:type="ChoiceTypeSpecifier">
                              <choice localId="1119" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                              <choice localId="1120" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                           </asTypeSpecifier>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand localId="613" name="activities">
            <operandTypeSpecifier localId="603" locator="202:14-202:126" xsi:type="ListTypeSpecifier">
               <elementType localId="604" locator="202:19-202:125" xsi:type="TupleTypeSpecifier">
                  <element localId="605" locator="202:25-202:49" name="code">
                     <elementType localId="606" locator="202:30-202:49" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="607" locator="202:51-202:76" name="plannedDue">
                     <elementType localId="608" locator="202:62-202:76" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="609" locator="202:78-202:105" name="plannedStart">
                     <elementType localId="610" locator="202:91-202:105" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="611" locator="202:107-202:124" name="timing">
                     <elementType localId="612" locator="202:114-202:124" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                  </element>
               </elementType>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="227" locator="192:1-193:71" name="MammogramPlannedActivity" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="227">
               <a:s>//------------------------------------------------------------------------------
// Activity
//------------------------------------------------------------------------------

define MammogramPlannedActivity:
  </a:s>
               <a:s r="586">
                  <a:s>NextPlannedActivityByCode(</a:s>
                  <a:s r="570">
                     <a:s>ScreeningActivities</a:s>
                  </a:s>
                  <a:s>, </a:s>
                  <a:s r="571">
                     <a:s>&quot;MG Breast Screening&quot;</a:s>
                  </a:s>
                  <a:s>)</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="586" locator="193:3-193:71" name="NextPlannedActivityByCode" xsi:type="FunctionRef">
            <operand localId="570" locator="193:29-193:47" name="ScreeningActivities" xsi:type="ExpressionRef"/>
            <operand localId="571" locator="193:50-193:70" name="MG Breast Screening" xsi:type="CodeRef"/>
         </expression>
      </def>
      <def localId="225" locator="55:1-56:66" name="eve-nextdueexists" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="225">
               <a:s>//calculated nextdue logic:
//  +duedate, -interval, -lastreport or +lastreport &lt; duedate = use duedate
//  +duedate, +interval, -lastreport or +lastreport &lt; duedate = use duedate
//  +duedate, -interval, +lastreport > duedate = no prediction
//  +duedate, +interval, +lastreport > duedate = use lastreport + interval
//  -duedate = use CalculateNextDueByCodeAndInterval
// mammogram only and in age range:
//  +duedate, -interval, +lastreport > duedate = use lastreport + 24mos
//  -duedate, -interval, +lastreport = use lastreport + 24mos
//  no activity = use today
//return{
//  code: action.code
//  nextdue: calculated date
//  planneddue: action.timingTiming.event
//  plannedstart: action.timingTiming.repeat.boundsPeriod.start
//  plannedrepeat: action.timingTiming.repeat
//  lastReportDate: DiagnosticReport date
//  flag: &quot;NOT DUE&quot;, &quot;DUE&quot;, &quot;OVERDUE&quot;, none
//}

define &quot;eve-nextdueexists&quot;:
  </a:s>
               <a:s r="666">
                  <a:s r="660">
                     <a:s>ActivityPlannedDate(</a:s>
                     <a:s r="659">
                        <a:s r="658">
                           <a:s>MammogramPlannedActivity</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="659">
                           <a:s>timing</a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
                  <a:s> is not null</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="666" locator="56:3-56:66" xsi:type="Not">
            <operand localId="665" locator="56:3-56:66" xsi:type="IsNull">
               <operand localId="660" locator="56:3-56:54" name="ActivityPlannedDate" xsi:type="FunctionRef">
                  <operand localId="661" xsi:type="As">
                     <operand localId="659" locator="56:23-56:53" path="timing" xsi:type="Property">
                        <source localId="658" locator="56:23-56:46" name="MammogramPlannedActivity" xsi:type="ExpressionRef"/>
                     </operand>
                     <asTypeSpecifier localId="662" xsi:type="ChoiceTypeSpecifier">
                        <choice localId="663" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                        <choice localId="664" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                     </asTypeSpecifier>
                  </operand>
               </operand>
            </operand>
         </expression>
      </def>
      <def localId="693" locator="84:1-85:66" name="LastMammography" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="693">
               <a:s>define LastMammography:
  </a:s>
               <a:s r="696">
                  <a:s r="694">
                     <a:s>BCSMCommon</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="696">
                     <a:s>MostRecentDiagnosticReportByVS(</a:s>
                     <a:s r="695">
                        <a:s>&quot;Screening Mammogram&quot;</a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="696" locator="85:3-85:66" name="MostRecentDiagnosticReportByVS" libraryName="BCSMCommon" xsi:type="FunctionRef">
            <operand localId="695" locator="85:45-85:65" name="Screening Mammogram" preserve="true" xsi:type="ValueSetRef"/>
         </expression>
      </def>
      <def localId="668" locator="58:1-60:116" name="eve-noscreening27mo" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="668">
               <a:s>define &quot;eve-noscreening27mo&quot;:
  </a:s>
               <a:s r="669">
                  <a:s r="670">
                     <a:s r="671">
                        <a:s r="676">
                           <a:s>AgeInYears()</a:s>
                        </a:s>
                        <a:s r="678"> >= 40</a:s>
                     </a:s>
                     <a:s> and </a:s>
                     <a:s r="681">
                        <a:s r="686">
                           <a:s>AgeInYears()</a:s>
                        </a:s>
                        <a:s r="688"> &lt;=74</a:s>
                     </a:s>
                  </a:s>
                  <a:s> and 
  </a:s>
                  <a:s r="691">
                     <a:s>(</a:s>
                     <a:s r="691">
                        <a:s r="698">
                           <a:s r="697">
                              <a:s>LastMammography</a:s>
                           </a:s>
                           <a:s> is null</a:s>
                        </a:s>
                        <a:s> or </a:s>
                        <a:s r="699">
                           <a:s r="702">
                              <a:s>Today()</a:s>
                           </a:s>
                           <a:s> > </a:s>
                           <a:s r="703">
                              <a:s r="704">
                                 <a:s>(</a:s>
                                 <a:s r="704">
                                    <a:s r="708">
                                       <a:s r="705">
                                          <a:s>FHIRHelpers</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="708">
                                          <a:s>ToDateTime(</a:s>
                                          <a:s r="707">
                                             <a:s r="706">
                                                <a:s>LastMammography</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="707">
                                                <a:s>effective</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> as </a:s>
                                    <a:s r="711">
                                       <a:s>DateTime</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> + </a:s>
                              <a:s r="712">
                                 <a:s>27 months</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="669" locator="59:3-60:116" xsi:type="And">
            <operand localId="670" locator="59:3-59:42" xsi:type="And">
               <operand localId="671" locator="59:3-59:20" xsi:type="GreaterOrEqual">
                  <signature localId="679" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="680" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="676" locator="59:3-59:14" precision="Year" xsi:type="CalculateAge">
                     <signature localId="677" name="t:Date" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="675" path="birthDate.value" xsi:type="Property">
                        <source localId="674" name="Patient" xsi:type="ExpressionRef"/>
                     </operand>
                  </operand>
                  <operand localId="678" locator="59:19-59:20" valueType="t:Integer" value="40" xsi:type="Literal"/>
               </operand>
               <operand localId="681" locator="59:26-59:42" xsi:type="LessOrEqual">
                  <signature localId="689" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="690" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="686" locator="59:26-59:37" precision="Year" xsi:type="CalculateAge">
                     <signature localId="687" name="t:Date" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="685" path="birthDate.value" xsi:type="Property">
                        <source localId="684" name="Patient" xsi:type="ExpressionRef"/>
                     </operand>
                  </operand>
                  <operand localId="688" locator="59:41-59:42" valueType="t:Integer" value="74" xsi:type="Literal"/>
               </operand>
            </operand>
            <operand localId="691" locator="60:3-60:116" xsi:type="Or">
               <operand localId="698" locator="60:4-60:26" xsi:type="IsNull">
                  <operand localId="697" locator="60:4-60:18" name="LastMammography" xsi:type="ExpressionRef"/>
               </operand>
               <operand localId="699" locator="60:31-60:115" xsi:type="Greater">
                  <signature localId="718" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="719" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="716" xsi:type="ToDateTime">
                     <signature localId="717" name="t:Date" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="702" locator="60:31-60:37" xsi:type="Today"/>
                  </operand>
                  <operand localId="703" locator="60:41-60:115" xsi:type="Add">
                     <signature localId="713" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     <signature localId="714" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="704" locator="60:41-60:103" strict="false" xsi:type="As">
                        <operand localId="708" locator="60:42-60:90" name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <signature localId="710" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="709" asType="fhir:dateTime" xsi:type="As">
                              <operand localId="707" locator="60:65-60:89" path="effective" xsi:type="Property">
                                 <source localId="706" locator="60:65-60:79" name="LastMammography" xsi:type="ExpressionRef"/>
                              </operand>
                           </operand>
                        </operand>
                        <asTypeSpecifier localId="711" locator="60:95-60:102" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </operand>
                     <operand localId="712" locator="60:107-60:115" value="27" unit="months" xsi:type="Quantity"/>
                  </operand>
               </operand>
            </operand>
         </expression>
      </def>
      <def localId="739" locator="92:1-121:7" name="CalculateActivityNextDue" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="739">
               <a:s>//------------------------------------------------------------------------------
// calculated next due
//------------------------------------------------------------------------------

define function CalculateActivityNextDue(
  activity Tuple{code FHIR.CodeableConcept,plannedDue System.DateTime,plannedStart System.DateTime,timing FHIR.Timing}
):
  </a:s>
               <a:s r="1092">
                  <a:s r="1092">
                     <a:s>
                        <a:s r="952">
                           <a:s r="953">
                              <a:s>
                                 <a:s>activity</a:s>
                              </a:s>
                           </a:s>
                           <a:s> A</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  </a:s>
                     <a:s>
                        <a:s>let </a:s>
                        <a:s r="954">
                           <a:s>lastReport: </a:s>
                           <a:s r="958">
                              <a:s r="955">
                                 <a:s>BCSMCommon</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="958">
                                 <a:s>MostRecentDiagnosticReportByCode(</a:s>
                                 <a:s r="957">
                                    <a:s r="956">
                                       <a:s>A</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="957">
                                       <a:s>code</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
  </a:s>
                        <a:s r="960">
                           <a:s>lastReportDate: </a:s>
                           <a:s r="961">
                              <a:s r="965">
                                 <a:s r="962">
                                    <a:s>FHIRHelpers</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="965">
                                    <a:s>ToDateTime(</a:s>
                                    <a:s r="964">
                                       <a:s r="963">
                                          <a:s>lastReport</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="964">
                                          <a:s>effective</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> as </a:s>
                              <a:s r="968">
                                 <a:s>DateTime</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
  </a:s>
                        <a:s r="969">
                           <a:s>duedate: </a:s>
                           <a:s r="971">
                              <a:s r="970">
                                 <a:s>A</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="971">
                                 <a:s>plannedDue</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
  </a:s>
                        <a:s r="972">
                           <a:s>repeat: </a:s>
                           <a:s r="973">
                              <a:s>Tuple{</a:s>
                              <a:s>
                                 <a:s>frequency: </a:s>
                                 <a:s r="981">
                                    <a:s r="974">
                                       <a:s>FHIRHelpers</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="981">
                                       <a:s>ToInteger(</a:s>
                                       <a:s r="980">
                                          <a:s r="979">
                                             <a:s r="975">
                                                <a:s>(</a:s>
                                                <a:s r="975">
                                                   <a:s r="977">
                                                      <a:s r="976">
                                                         <a:s>A</a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="977">
                                                         <a:s>timing</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> as </a:s>
                                                   <a:s r="978">
                                                      <a:s>Timing</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="979">
                                                <a:s>repeat</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="980">
                                             <a:s>frequency</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>,
        </a:s>
                              <a:s>
                                 <a:s>period: </a:s>
                                 <a:s r="989">
                                    <a:s r="982">
                                       <a:s>FHIRHelpers</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="989">
                                       <a:s>ToDecimal(</a:s>
                                       <a:s r="988">
                                          <a:s r="987">
                                             <a:s r="983">
                                                <a:s>(</a:s>
                                                <a:s r="983">
                                                   <a:s r="985">
                                                      <a:s r="984">
                                                         <a:s>A</a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="985">
                                                         <a:s>timing</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> as </a:s>
                                                   <a:s r="986">
                                                      <a:s>Timing</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="987">
                                                <a:s>repeat</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="988">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>,
        </a:s>
                              <a:s>
                                 <a:s>periodUnit: </a:s>
                                 <a:s r="997">
                                    <a:s r="990">
                                       <a:s>FHIRHelpers</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="997">
                                       <a:s>ToString(</a:s>
                                       <a:s r="996">
                                          <a:s r="995">
                                             <a:s r="991">
                                                <a:s>(</a:s>
                                                <a:s r="991">
                                                   <a:s r="993">
                                                      <a:s r="992">
                                                         <a:s>A</a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="993">
                                                         <a:s>timing</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> as </a:s>
                                                   <a:s r="994">
                                                      <a:s>Timing</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="995">
                                                <a:s>repeat</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="996">
                                             <a:s>periodUnit</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>}</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  </a:s>
                     <a:s r="999">
                        <a:s>return
    </a:s>
                        <a:s r="1000">
                           <a:s>case
      // -duedate = use CalculateNextDueByCodeAndInterval
      </a:s>
                           <a:s r="1001">
                              <a:s>when </a:s>
                              <a:s r="1003">
                                 <a:s r="1002">
                                    <a:s>duedate</a:s>
                                 </a:s>
                                 <a:s> is null</a:s>
                              </a:s>
                              <a:s> then 
        </a:s>
                              <a:s r="1020">
                                 <a:s r="1004">
                                    <a:s>BCSMCommon</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="1020">
                                    <a:s>CalculateNextDueByCodeAndInterval(
          </a:s>
                                    <a:s r="1006">
                                       <a:s r="1005">
                                          <a:s>A</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="1006">
                                          <a:s>code</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>, 
          </a:s>
                                    <a:s r="1017">
                                       <a:s r="1007">
                                          <a:s>FHIRHelpers</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="1017">
                                          <a:s>ToDateTime(</a:s>
                                          <a:s r="1016">
                                             <a:s r="1008">
                                                <a:s>(</a:s>
                                                <a:s r="1008">
                                                   <a:s r="1014">
                                                      <a:s r="1013">
                                                         <a:s r="1009">
                                                            <a:s>(</a:s>
                                                            <a:s r="1009">
                                                               <a:s r="1011">
                                                                  <a:s r="1010">
                                                                     <a:s>A</a:s>
                                                                  </a:s>
                                                                  <a:s>.</a:s>
                                                                  <a:s r="1011">
                                                                     <a:s>timing</a:s>
                                                                  </a:s>
                                                               </a:s>
                                                               <a:s> as </a:s>
                                                               <a:s r="1012">
                                                                  <a:s>Timing</a:s>
                                                               </a:s>
                                                            </a:s>
                                                            <a:s>)</a:s>
                                                         </a:s>
                                                         <a:s>.</a:s>
                                                         <a:s r="1013">
                                                            <a:s>repeat</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="1014">
                                                         <a:s>bounds</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> as </a:s>
                                                   <a:s r="1015">
                                                      <a:s>Period</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="1016">
                                                <a:s>start</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
          </a:s>
                                    <a:s r="1019">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
      // +duedate, -repeat, -lastreport or +lastreport &lt; duedate = use duedate
      </a:s>
                           <a:s r="1022">
                              <a:s>when </a:s>
                              <a:s r="1023">
                                 <a:s r="1027">
                                    <a:s r="1026">
                                       <a:s r="1024">
                                          <a:s>BCSMCommon</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="1026">
                                          <a:s>RepeatIsValid(</a:s>
                                          <a:s r="1025">
                                             <a:s>repeat</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> is false</a:s>
                                 </a:s>
                                 <a:s> and </a:s>
                                 <a:s r="1028">
                                    <a:s>(</a:s>
                                    <a:s r="1028">
                                       <a:s r="1030">
                                          <a:s r="1029">
                                             <a:s>lastReport</a:s>
                                          </a:s>
                                          <a:s> is null</a:s>
                                       </a:s>
                                       <a:s> or </a:s>
                                       <a:s r="1031">
                                          <a:s r="1032">
                                             <a:s>lastReportDate</a:s>
                                          </a:s>
                                          <a:s> &lt; </a:s>
                                          <a:s r="1033">
                                             <a:s>duedate</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> then </a:s>
                              <a:s r="1036">
                                 <a:s>duedate</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
      // +duedate, +repeat, -lastreport or +lastreport &lt; duedate = use duedate
      </a:s>
                           <a:s r="1037">
                              <a:s>when </a:s>
                              <a:s r="1038">
                                 <a:s r="1041">
                                    <a:s r="1039">
                                       <a:s>BCSMCommon</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="1041">
                                       <a:s>RepeatIsValid(</a:s>
                                       <a:s r="1040">
                                          <a:s>repeat</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> and </a:s>
                                 <a:s r="1042">
                                    <a:s>(</a:s>
                                    <a:s r="1042">
                                       <a:s r="1044">
                                          <a:s r="1043">
                                             <a:s>lastReport</a:s>
                                          </a:s>
                                          <a:s> is null</a:s>
                                       </a:s>
                                       <a:s> or </a:s>
                                       <a:s r="1045">
                                          <a:s r="1046">
                                             <a:s>lastReportDate</a:s>
                                          </a:s>
                                          <a:s> &lt; </a:s>
                                          <a:s r="1047">
                                             <a:s>duedate</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> then </a:s>
                              <a:s r="1050">
                                 <a:s>duedate</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
      // +duedate, -repeat, +lastreport > duedate = no prediction
      </a:s>
                           <a:s r="1051">
                              <a:s>when </a:s>
                              <a:s r="1052">
                                 <a:s r="1053">
                                    <a:s r="1057">
                                       <a:s r="1056">
                                          <a:s r="1054">
                                             <a:s>BCSMCommon</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="1056">
                                             <a:s>RepeatIsValid(</a:s>
                                             <a:s r="1055">
                                                <a:s>repeat</a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> is false</a:s>
                                    </a:s>
                                    <a:s> and </a:s>
                                    <a:s r="1060">
                                       <a:s r="1058">
                                          <a:s>lastReport</a:s>
                                       </a:s>
                                       <a:s> is not null</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> and </a:s>
                                 <a:s r="1061">
                                    <a:s r="1062">
                                       <a:s>lastReportDate</a:s>
                                    </a:s>
                                    <a:s> > </a:s>
                                    <a:s r="1063">
                                       <a:s>duedate</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="1066"> then null</a:s>
                           </a:s>
                           <a:s>
      // +duedate, +repeat, +lastreport > duedate = use lastreport + repeat
      </a:s>
                           <a:s r="1067">
                              <a:s>when </a:s>
                              <a:s r="1068">
                                 <a:s r="1069">
                                    <a:s r="1072">
                                       <a:s r="1070">
                                          <a:s>BCSMCommon</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="1072">
                                          <a:s>RepeatIsValid(</a:s>
                                          <a:s r="1071">
                                             <a:s>repeat</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> and </a:s>
                                    <a:s r="1075">
                                       <a:s r="1073">
                                          <a:s>lastReport</a:s>
                                       </a:s>
                                       <a:s> is not null</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> and </a:s>
                                 <a:s r="1076">
                                    <a:s r="1077">
                                       <a:s>lastReportDate</a:s>
                                    </a:s>
                                    <a:s> > </a:s>
                                    <a:s r="1078">
                                       <a:s>duedate</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s> then
        </a:s>
                              <a:s r="1081">
                                 <a:s>date from </a:s>
                                 <a:s r="1085">
                                    <a:s r="1082">
                                       <a:s>BCSMCommon</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="1085">
                                       <a:s>AddIntervalToDateTime(</a:s>
                                       <a:s r="1083">
                                          <a:s>lastReportDate</a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="1084">
                                          <a:s>repeat</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s r="1086">
      // Default case if none of the above conditions are met      
      else null
    end</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="1092" locator="95:3-121:7" xsi:type="Query">
            <source localId="952" locator="95:3-95:12" alias="A">
               <expression localId="953" locator="95:3-95:10" name="activity" xsi:type="OperandRef"/>
            </source>
            <let localId="954" locator="96:7-96:69" identifier="lastReport">
               <expression localId="958" locator="96:19-96:69" name="MostRecentDiagnosticReportByCode" libraryName="BCSMCommon" xsi:type="FunctionRef">
                  <operand localId="959" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand localId="957" locator="96:63-96:68" path="code" scope="A" xsi:type="Property"/>
                  </operand>
               </expression>
            </let>
            <let localId="960" locator="97:3-97:74" identifier="lastReportDate">
               <expression localId="961" locator="97:19-97:74" strict="false" xsi:type="As">
                  <operand localId="965" locator="97:19-97:62" name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <signature localId="967" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="966" asType="fhir:dateTime" xsi:type="As">
                        <operand localId="964" locator="97:42-97:61" path="effective" xsi:type="Property">
                           <source localId="963" locator="97:42-97:51" name="lastReport" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <asTypeSpecifier localId="968" locator="97:67-97:74" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </expression>
            </let>
            <let localId="969" locator="98:3-98:23" identifier="duedate">
               <expression localId="971" locator="98:12-98:23" path="plannedDue" scope="A" xsi:type="Property"/>
            </let>
            <let localId="972" locator="99:3-101:81" identifier="repeat">
               <expression localId="973" locator="99:11-101:81" xsi:type="Tuple">
                  <element name="frequency">
                     <value localId="981" locator="99:28-99:87" name="ToInteger" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand localId="980" locator="99:50-99:86" path="frequency" xsi:type="Property">
                           <source localId="979" locator="99:50-99:76" path="repeat" xsi:type="Property">
                              <source localId="975" locator="99:50-99:69" strict="false" xsi:type="As">
                                 <operand localId="977" locator="99:51-99:58" path="timing" scope="A" xsi:type="Property"/>
                                 <asTypeSpecifier localId="978" locator="99:63-99:68" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                     </value>
                  </element>
                  <element name="period">
                     <value localId="989" locator="100:17-100:73" name="ToDecimal" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand localId="988" locator="100:39-100:72" path="period" xsi:type="Property">
                           <source localId="987" locator="100:39-100:65" path="repeat" xsi:type="Property">
                              <source localId="983" locator="100:39-100:58" strict="false" xsi:type="As">
                                 <operand localId="985" locator="100:40-100:47" path="timing" scope="A" xsi:type="Property"/>
                                 <asTypeSpecifier localId="986" locator="100:52-100:57" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                     </value>
                  </element>
                  <element name="periodUnit">
                     <value localId="997" locator="101:21-101:80" name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <signature localId="998" name="fhir:UnitsOfTime" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="996" locator="101:42-101:79" path="periodUnit" xsi:type="Property">
                           <source localId="995" locator="101:42-101:68" path="repeat" xsi:type="Property">
                              <source localId="991" locator="101:42-101:61" strict="false" xsi:type="As">
                                 <operand localId="993" locator="101:43-101:50" path="timing" scope="A" xsi:type="Property"/>
                                 <asTypeSpecifier localId="994" locator="101:55-101:60" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                     </value>
                  </element>
               </expression>
            </let>
            <return localId="999" locator="102:3-121:7">
               <expression localId="1000" locator="103:5-121:7" xsi:type="Case">
                  <caseItem localId="1001" locator="105:7-109:17">
                     <when localId="1003" locator="105:12-105:26" xsi:type="IsNull">
                        <operand localId="1002" locator="105:12-105:18" name="duedate" xsi:type="QueryLetRef"/>
                     </when>
                     <then localId="1020" locator="106:9-109:17" name="CalculateNextDueByCodeAndInterval" libraryName="BCSMCommon" xsi:type="FunctionRef">
                        <operand localId="1021" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <operand localId="1006" locator="107:11-107:16" path="code" scope="A" xsi:type="Property"/>
                        </operand>
                        <operand localId="1017" locator="108:11-108:86" name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <signature localId="1018" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="1016" locator="108:34-108:85" path="start" xsi:type="Property">
                              <source localId="1008" locator="108:34-108:79" strict="false" xsi:type="As">
                                 <operand localId="1014" locator="108:35-108:68" path="bounds" xsi:type="Property">
                                    <source localId="1013" locator="108:35-108:61" path="repeat" xsi:type="Property">
                                       <source localId="1009" locator="108:35-108:54" strict="false" xsi:type="As">
                                          <operand localId="1011" locator="108:36-108:43" path="timing" scope="A" xsi:type="Property"/>
                                          <asTypeSpecifier localId="1012" locator="108:48-108:53" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                                       </source>
                                    </source>
                                 </operand>
                                 <asTypeSpecifier localId="1015" locator="108:73-108:78" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </operand>
                        </operand>
                        <operand localId="1019" locator="109:11-109:16" name="repeat" xsi:type="QueryLetRef"/>
                     </then>
                  </caseItem>
                  <caseItem localId="1022" locator="111:7-111:118">
                     <when localId="1023" locator="111:12-111:105" xsi:type="And">
                        <operand localId="1027" locator="111:12-111:52" xsi:type="IsFalse">
                           <operand localId="1026" locator="111:12-111:43" name="RepeatIsValid" libraryName="BCSMCommon" xsi:type="FunctionRef">
                              <operand localId="1025" locator="111:37-111:42" name="repeat" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                        <operand localId="1028" locator="111:58-111:105" xsi:type="Or">
                           <operand localId="1030" locator="111:59-111:76" xsi:type="IsNull">
                              <operand localId="1029" locator="111:59-111:68" name="lastReport" xsi:type="QueryLetRef"/>
                           </operand>
                           <operand localId="1031" locator="111:81-111:104" xsi:type="Less">
                              <signature localId="1034" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <signature localId="1035" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="1032" locator="111:81-111:94" name="lastReportDate" xsi:type="QueryLetRef"/>
                              <operand localId="1033" locator="111:98-111:104" name="duedate" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </when>
                     <then localId="1036" locator="111:112-111:118" name="duedate" xsi:type="QueryLetRef"/>
                  </caseItem>
                  <caseItem localId="1037" locator="113:7-113:109">
                     <when localId="1038" locator="113:12-113:96" xsi:type="And">
                        <operand localId="1041" locator="113:12-113:43" name="RepeatIsValid" libraryName="BCSMCommon" xsi:type="FunctionRef">
                           <operand localId="1040" locator="113:37-113:42" name="repeat" xsi:type="QueryLetRef"/>
                        </operand>
                        <operand localId="1042" locator="113:49-113:96" xsi:type="Or">
                           <operand localId="1044" locator="113:50-113:67" xsi:type="IsNull">
                              <operand localId="1043" locator="113:50-113:59" name="lastReport" xsi:type="QueryLetRef"/>
                           </operand>
                           <operand localId="1045" locator="113:72-113:95" xsi:type="Less">
                              <signature localId="1048" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <signature localId="1049" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="1046" locator="113:72-113:85" name="lastReportDate" xsi:type="QueryLetRef"/>
                              <operand localId="1047" locator="113:89-113:95" name="duedate" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </when>
                     <then localId="1050" locator="113:103-113:109" name="duedate" xsi:type="QueryLetRef"/>
                  </caseItem>
                  <caseItem localId="1051" locator="115:7-115:118">
                     <when localId="1052" locator="115:12-115:108" xsi:type="And">
                        <operand localId="1053" locator="115:12-115:79" xsi:type="And">
                           <operand localId="1057" locator="115:12-115:52" xsi:type="IsFalse">
                              <operand localId="1056" locator="115:12-115:43" name="RepeatIsValid" libraryName="BCSMCommon" xsi:type="FunctionRef">
                                 <operand localId="1055" locator="115:37-115:42" name="repeat" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                           <operand localId="1060" locator="115:58-115:79" xsi:type="Not">
                              <operand localId="1059" locator="115:58-115:79" xsi:type="IsNull">
                                 <operand localId="1058" locator="115:58-115:67" name="lastReport" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                        <operand localId="1061" locator="115:85-115:108" xsi:type="Greater">
                           <signature localId="1064" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           <signature localId="1065" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="1062" locator="115:85-115:98" name="lastReportDate" xsi:type="QueryLetRef"/>
                           <operand localId="1063" locator="115:102-115:108" name="duedate" xsi:type="QueryLetRef"/>
                        </operand>
                     </when>
                     <then localId="1087" asType="t:DateTime" xsi:type="As">
                        <operand localId="1066" locator="115:115-115:118" xsi:type="Null"/>
                     </then>
                  </caseItem>
                  <caseItem localId="1067" locator="117:7-118:74">
                     <when localId="1068" locator="117:12-117:99" xsi:type="And">
                        <operand localId="1069" locator="117:12-117:70" xsi:type="And">
                           <operand localId="1072" locator="117:12-117:43" name="RepeatIsValid" libraryName="BCSMCommon" xsi:type="FunctionRef">
                              <operand localId="1071" locator="117:37-117:42" name="repeat" xsi:type="QueryLetRef"/>
                           </operand>
                           <operand localId="1075" locator="117:49-117:70" xsi:type="Not">
                              <operand localId="1074" locator="117:49-117:70" xsi:type="IsNull">
                                 <operand localId="1073" locator="117:49-117:58" name="lastReport" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                        <operand localId="1076" locator="117:76-117:99" xsi:type="Greater">
                           <signature localId="1079" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           <signature localId="1080" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="1077" locator="117:76-117:89" name="lastReportDate" xsi:type="QueryLetRef"/>
                           <operand localId="1078" locator="117:93-117:99" name="duedate" xsi:type="QueryLetRef"/>
                        </operand>
                     </when>
                     <then localId="1089" xsi:type="ToDateTime">
                        <signature localId="1090" name="t:Date" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="1081" locator="118:9-118:74" xsi:type="DateFrom">
                           <operand localId="1085" locator="118:19-118:74" name="AddIntervalToDateTime" libraryName="BCSMCommon" xsi:type="FunctionRef">
                              <operand localId="1083" locator="118:52-118:65" name="lastReportDate" xsi:type="QueryLetRef"/>
                              <operand localId="1084" locator="118:68-118:73" name="repeat" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </then>
                  </caseItem>
                  <else localId="1091" asType="t:DateTime" xsi:type="As">
                     <operand localId="1086" locator="120:12-120:15" xsi:type="Null"/>
                  </else>
               </expression>
            </return>
         </expression>
         <operand localId="749" name="activity">
            <operandTypeSpecifier localId="740" locator="93:12-93:118" xsi:type="TupleTypeSpecifier">
               <element localId="741" locator="93:18-93:42" name="code">
                  <elementType localId="742" locator="93:23-93:42" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
               </element>
               <element localId="743" locator="93:44-93:69" name="plannedDue">
                  <elementType localId="744" locator="93:55-93:69" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </element>
               <element localId="745" locator="93:71-93:98" name="plannedStart">
                  <elementType localId="746" locator="93:84-93:98" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </element>
               <element localId="747" locator="93:100-93:117" name="timing">
                  <elementType localId="748" locator="93:107-93:117" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
               </element>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="724" locator="65:1-79:3" name="CarePlanActivitiesDue" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="724">
               <a:s>define CarePlanActivitiesDue:
  </a:s>
               <a:s r="938">
                  <a:s>
                     <a:s r="725">
                        <a:s r="726">
                           <a:s>
                              <a:s>ScreeningActivities</a:s>
                           </a:s>
                        </a:s>
                        <a:s> A</a:s>
                     </a:s>
                  </a:s>
                  <a:s>
  </a:s>
                  <a:s>
                     <a:s>let </a:s>
                     <a:s r="727">
                        <a:s>lastReport: </a:s>
                        <a:s r="731">
                           <a:s r="728">
                              <a:s>BCSMCommon</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="731">
                              <a:s>MostRecentDiagnosticReportByCode(</a:s>
                              <a:s r="730">
                                 <a:s r="729">
                                    <a:s>A</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="730">
                                    <a:s>code</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>,
  </a:s>
                     <a:s r="733">
                        <a:s>lastReportDate: </a:s>
                        <a:s r="736">
                           <a:s r="734">
                              <a:s>CSMCommonFunctions</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="736">
                              <a:s>DiagnosticReportDate(</a:s>
                              <a:s r="735">
                                 <a:s>lastReport</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>,
  </a:s>
                     <a:s r="737">
                        <a:s>nextdue: </a:s>
                        <a:s r="750">
                           <a:s>CalculateActivityNextDue(</a:s>
                           <a:s r="738">
                              <a:s>A</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
                  <a:s>
  </a:s>
                  <a:s r="892">
                     <a:s>return </a:s>
                     <a:s r="893">
                        <a:s>{
    </a:s>
                        <a:s>
                           <a:s>code: </a:s>
                           <a:s r="895">
                              <a:s r="894">
                                 <a:s>A</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="895">
                                 <a:s>code</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    </a:s>
                        <a:s>
                           <a:s>intent: </a:s>
                           <a:s r="896">
                              <a:s>'plan'</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    </a:s>
                        <a:s>
                           <a:s>nextDue: </a:s>
                           <a:s r="897">
                              <a:s>nextdue</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    </a:s>
                        <a:s>
                           <a:s>plannedDue: </a:s>
                           <a:s r="899">
                              <a:s r="898">
                                 <a:s>A</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="899">
                                 <a:s>plannedDue</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    </a:s>
                        <a:s>
                           <a:s>plannedStart: </a:s>
                           <a:s r="901">
                              <a:s r="900">
                                 <a:s>A</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="901">
                                 <a:s>plannedStart</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    </a:s>
                        <a:s>
                           <a:s>plannedRepeat: </a:s>
                           <a:s r="908">
                              <a:s r="902">
                                 <a:s>BCSMCommon</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="908">
                                 <a:s>EvaluateInterval(</a:s>
                                 <a:s r="907">
                                    <a:s r="903">
                                       <a:s>(</a:s>
                                       <a:s r="903">
                                          <a:s r="905">
                                             <a:s r="904">
                                                <a:s>A</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="905">
                                                <a:s>timing</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> as </a:s>
                                          <a:s r="906">
                                             <a:s>FHIR.Timing</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="907">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    </a:s>
                        <a:s>
                           <a:s>lastReportDate: </a:s>
                           <a:s r="919">
                              <a:s>lastReportDate</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    </a:s>
                        <a:s>
                           <a:s>flag: </a:s>
                           <a:s r="927">
                              <a:s r="920">
                                 <a:s>BCSMCommon</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="927">
                                 <a:s>EvaluateFlag(</a:s>
                                 <a:s r="925">
                                    <a:s r="921">
                                       <a:s>(</a:s>
                                       <a:s r="921">
                                          <a:s r="923">
                                             <a:s r="922">
                                                <a:s>A</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="923">
                                                <a:s>timing</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> as </a:s>
                                          <a:s r="924">
                                             <a:s>FHIR.Timing</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="925">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="926">
                                    <a:s>nextdue</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
  }</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="938" locator="66:3-79:3" xsi:type="Query">
            <source localId="725" locator="66:3-66:23" alias="A">
               <expression localId="726" locator="66:3-66:21" name="ScreeningActivities" xsi:type="ExpressionRef"/>
            </source>
            <let localId="727" locator="67:7-67:69" identifier="lastReport">
               <expression localId="731" locator="67:19-67:69" name="MostRecentDiagnosticReportByCode" libraryName="BCSMCommon" xsi:type="FunctionRef">
                  <operand localId="732" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand localId="730" locator="67:63-67:68" path="code" scope="A" xsi:type="Property"/>
                  </operand>
               </expression>
            </let>
            <let localId="733" locator="68:3-68:69" identifier="lastReportDate">
               <expression localId="736" locator="68:19-68:69" name="DiagnosticReportDate" libraryName="CSMCommonFunctions" xsi:type="FunctionRef">
                  <operand localId="735" locator="68:59-68:68" name="lastReport" xsi:type="QueryLetRef"/>
               </expression>
            </let>
            <let localId="737" locator="69:3-69:38" identifier="nextdue">
               <expression localId="750" locator="69:12-69:38" name="CalculateActivityNextDue" xsi:type="FunctionRef">
                  <operand localId="738" locator="69:37" name="A" xsi:type="AliasRef"/>
               </expression>
            </let>
            <return localId="892" locator="70:3-79:3">
               <expression localId="893" locator="70:10-79:3" xsi:type="Tuple">
                  <element name="code">
                     <value localId="895" locator="71:11-71:16" path="code" scope="A" xsi:type="Property"/>
                  </element>
                  <element name="intent">
                     <value localId="896" locator="72:13-72:18" valueType="t:String" value="plan" xsi:type="Literal"/>
                  </element>
                  <element name="nextDue">
                     <value localId="897" locator="73:14-73:20" name="nextdue" xsi:type="QueryLetRef"/>
                  </element>
                  <element name="plannedDue">
                     <value localId="899" locator="74:17-74:28" path="plannedDue" scope="A" xsi:type="Property"/>
                  </element>
                  <element name="plannedStart">
                     <value localId="901" locator="75:19-75:32" path="plannedStart" scope="A" xsi:type="Property"/>
                  </element>
                  <element name="plannedRepeat">
                     <value localId="908" locator="76:20-76:80" name="EvaluateInterval" libraryName="BCSMCommon" xsi:type="FunctionRef">
                        <operand localId="909" xsi:type="As">
                           <operand localId="907" locator="76:48-76:79" path="repeat" xsi:type="Property">
                              <source localId="903" locator="76:48-76:72" strict="false" xsi:type="As">
                                 <operand localId="905" locator="76:49-76:56" path="timing" scope="A" xsi:type="Property"/>
                                 <asTypeSpecifier localId="906" locator="76:61-76:71" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </operand>
                           <asTypeSpecifier localId="910" xsi:type="ChoiceTypeSpecifier">
                              <choice localId="911" name="fhir:Timing.Repeat" xsi:type="NamedTypeSpecifier"/>
                              <choice localId="912" xsi:type="TupleTypeSpecifier">
                                 <element localId="913" name="frequency">
                                    <elementType localId="914" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                                 </element>
                                 <element localId="915" name="period">
                                    <elementType localId="916" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                                 </element>
                                 <element localId="917" name="periodUnit">
                                    <elementType localId="918" name="t:String" xsi:type="NamedTypeSpecifier"/>
                                 </element>
                              </choice>
                           </asTypeSpecifier>
                        </operand>
                     </value>
                  </element>
                  <element name="lastReportDate">
                     <value localId="919" locator="77:21-77:34" name="lastReportDate" xsi:type="QueryLetRef"/>
                  </element>
                  <element name="flag">
                     <value localId="927" locator="78:11-78:76" name="EvaluateFlag" libraryName="BCSMCommon" xsi:type="FunctionRef">
                        <operand localId="928" xsi:type="As">
                           <operand localId="925" locator="78:35-78:66" path="repeat" xsi:type="Property">
                              <source localId="921" locator="78:35-78:59" strict="false" xsi:type="As">
                                 <operand localId="923" locator="78:36-78:43" path="timing" scope="A" xsi:type="Property"/>
                                 <asTypeSpecifier localId="924" locator="78:48-78:58" name="fhir:Timing" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </operand>
                           <asTypeSpecifier localId="929" xsi:type="ChoiceTypeSpecifier">
                              <choice localId="930" name="fhir:Timing.Repeat" xsi:type="NamedTypeSpecifier"/>
                              <choice localId="931" xsi:type="TupleTypeSpecifier">
                                 <element localId="932" name="frequency">
                                    <elementType localId="933" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                                 </element>
                                 <element localId="934" name="period">
                                    <elementType localId="935" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                                 </element>
                                 <element localId="936" name="periodUnit">
                                    <elementType localId="937" name="t:String" xsi:type="NamedTypeSpecifier"/>
                                 </element>
                              </choice>
                           </asTypeSpecifier>
                        </operand>
                        <operand localId="926" locator="78:69-78:75" name="nextdue" xsi:type="QueryLetRef"/>
                     </value>
                  </element>
               </expression>
            </return>
         </expression>
      </def>
      <def localId="721" locator="62:1-63:82" name="eve-due" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="721">
               <a:s>define &quot;eve-due&quot;:
  </a:s>
               <a:s r="951">
                  <a:s>
                     <a:s r="722">
                        <a:s r="939">
                           <a:s>
                              <a:s>CarePlanActivitiesDue</a:s>
                           </a:s>
                        </a:s>
                        <a:s> A</a:s>
                     </a:s>
                  </a:s>
                  <a:s> </a:s>
                  <a:s r="947">
                     <a:s>where </a:s>
                     <a:s r="947">
                        <a:s r="941">
                           <a:s r="940">
                              <a:s>A</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="941">
                              <a:s>flag</a:s>
                           </a:s>
                        </a:s>
                        <a:s> in </a:s>
                        <a:s r="942">
                           <a:s>{</a:s>
                           <a:s r="944">
                              <a:s r="943">
                                 <a:s>BCSMCommon</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="944">
                                 <a:s>&quot;DUE&quot;</a:s>
                              </a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="946">
                              <a:s r="945">
                                 <a:s>BCSMCommon</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="946">
                                 <a:s>&quot;OVERDUE&quot;</a:s>
                              </a:s>
                           </a:s>
                           <a:s>}</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="951" locator="63:3-63:82" xsi:type="Query">
            <source localId="722" locator="63:3-63:25" alias="A">
               <expression localId="939" locator="63:3-63:23" name="CarePlanActivitiesDue" xsi:type="ExpressionRef"/>
            </source>
            <where localId="947" locator="63:27-63:82" xsi:type="In">
               <signature localId="948" name="t:Code" xsi:type="NamedTypeSpecifier"/>
               <signature localId="949" xsi:type="ListTypeSpecifier">
                  <elementType localId="950" name="t:Code" xsi:type="NamedTypeSpecifier"/>
               </signature>
               <operand localId="941" locator="63:33-63:38" path="flag" scope="A" xsi:type="Property"/>
               <operand localId="942" locator="63:43-63:82" xsi:type="List">
                  <element localId="944" locator="63:44-63:59" name="DUE" libraryName="BCSMCommon" xsi:type="CodeRef"/>
                  <element localId="946" locator="63:62-63:81" name="OVERDUE" libraryName="BCSMCommon" xsi:type="CodeRef"/>
               </operand>
            </where>
         </expression>
      </def>
   </statements>
</library>
